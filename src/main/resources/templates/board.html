<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>게시판 목록</title>
</head>
<body>
<h1>게시판</h1>

<form id="searchForm">
    <input type="text" id="keyword" placeholder="제목 검색" />
    <button type="submit">검색</button>
    <a href="post-form.html">글쓰기</a>
</form>

<table border="1" width="100%" id="listTable">
    <thead>
    <tr><th>ID</th><th>제목</th><th>작성자</th><th>작성일</th><th>액션</th></tr>
    </thead>
    <tbody></tbody>
</table>

<div id="paging"></div>

<script>
    let page = 0, size = 10;

    async function load() {
        const keyword = document.getElementById('keyword').value.trim();
        const qs = new URLSearchParams({ page, size });
        if (keyword) qs.set('keyword', keyword);

        const res = await fetch(`/api/posts?${qs.toString()}`);
        const data = await res.json();

        const tbody = document.querySelector('#listTable tbody');
        tbody.innerHTML = '';
        data.content.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
          <td>${p.id}</td>
          <td><a href="post-detail.html?id=${p.id}">${p.title}</a></td>
          <td>${p.author}</td>
          <td>${p.createdAt ?? ''}</td>
          <td>
            <a href="post-form.html?id=${p.id}">수정</a>
            <button onclick="del(${p.id})">삭제</button>
          </td>`;
            tbody.appendChild(tr);
        });

        const paging = document.getElementById('paging');
        paging.innerHTML = '';
        for (let i = 0; i < data.totalPages; i++) {
            const a = document.createElement('a');
            a.href = "#";
            a.textContent = `[${i}]`;
            a.style.marginRight = '8px';
            a.onclick = (e) => { e.preventDefault(); page = i; load(); };
            if (i === data.page) a.style.fontWeight = 'bold';
            paging.appendChild(a);
        }
    }

    async function del(id) {
        if (!confirm('삭제할까요?')) return;
        const res = await fetch(`/api/posts/${id}`, { method: 'DELETE' });
        if (res.ok) load();
        else alert('삭제 실패');
    }

    document.getElementById('searchForm').addEventListener('submit', e => {
        e.preventDefault();
        page = 0;
        load();
    });

    load();
</script>
</body>
</html>